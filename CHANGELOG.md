# ObjectSync 更新日志

所有重要的更新都会记录在这个文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
项目遵循 [语义化版本](https://semver.org/spec/v2.0.0.html)。

## [0.1.1] - 2025-01-17

### 🐛 修复问题

- **删除未使用字段**: 删除App结构体中未使用的config字段
- **修复Linter警告**: 修复`field config is unused (U1000)`警告
- **代码清理**: 提高代码整洁性和可维护性

### 🔧 技术改进

- **配置管理优化**: 配置管理器改为在需要时局部创建，而非作为结构体字段
- **代码结构优化**: 清理未使用的结构体字段
- **最佳实践**: 符合Go代码最佳实践和编码规范

### 📝 说明

这是一个补丁版本修复，专注于提高代码质量，无功能变更。

---

## [v0.1.0] - 2025-06-27

### 🎉 重大功能更新

ObjectSync 现在支持双向同步！从单一的下载工具升级为完整的对象存储同步解决方案。

### ✨ 新增功能

- **📤 文件上传功能**: 全新的上传模块，将本地文件上传到对象存储
- **🔄 双向同步**: 完整的下载和上传能力，实现真正的双向数据同步
- **🎯 智能多桶上传**: 每个桶从其配置的本地目录独立上传数据
- **🆕 upload命令**: 新增`objectsync upload`命令，与backup命令对等
- **⚡ 并发上传**: 支持多线程并发上传，充分利用带宽
- **📊 上传进度跟踪**: 实时显示上传进度、速度和统计信息
- **🗂️ 目录结构保持**: 完全保持本地目录结构到对象存储
- **🪣 自动创桶**: 目标存储桶不存在时自动创建
- **💾 独立状态管理**: 每个桶使用独立的上传状态文件

### 🎮 交互式界面改进

- **🔄 新增上传菜单**: 主菜单增加"开始上传"选项
- **📋 智能配置显示**: 显示所有配置桶的状态和本地目录检查
- **✅ 用户确认流程**: 上传前显示详细信息并询问用户确认
- **🔍 实时状态检查**: 检查本地目录是否存在，显示清晰的状态标识

### 🔧 技术架构改进

- **📦 新增upload模块**: `internal/upload/`包含完整的上传功能
- **🏗️ 模块化设计**: 上传和下载模块独立，便于维护和扩展
- **🔄 配置兼容性**: 复用现有配置文件结构，无需额外配置
- **📄 独立状态文件**: 使用`.upload_<桶名>_state.json`格式避免冲突
- **🎯 架构简化**: 删除单桶模式，完全基于配置文件驱动的多桶架构

### 🚀 上传功能特性

#### 配置文件驱动模式
- 每个桶从其配置的`output_dir`目录上传数据
- 自动跳过不存在的本地目录
- 独立的上传状态管理和进度跟踪

### 📖 使用方式扩展

#### 交互式上传
```bash
# 启动交互菜单，选择[3] 开始上传
objectsync
```

#### 命令行上传
```bash
# 上传所有配置的桶
objectsync upload

# 详细模式上传
objectsync upload -v

# 指定并发数
objectsync upload -w 10

# 覆盖连接配置
objectsync upload -e http://ceph.example.com:7480 -a mykey -s mysecret
```

### 🎯 工作流程完善

现在支持完整的数据同步工作流：

1. **下载阶段**: `objectsync backup` - 从对象存储下载到本地
2. **处理阶段**: 在本地处理、修改、添加文件
3. **上传阶段**: `objectsync upload` - 将修改后的数据上传回对象存储

### 🔄 多桶智能映射

- **下载时**: 每个桶下载到其配置的`output_dir`
- **上传时**: 每个桶从其配置的`output_dir`上传数据
- **状态管理**: 下载和上传使用独立的状态文件系统

### 📝 项目定位更新

- **原定位**: 对象存储下载工具
- **新定位**: 对象存储同步工具（双向数据同步）

### ⚙️ 简化的命令参数

#### `objectsync upload`命令参数：
- `-c, --config`: 配置文件路径
- `-e, --endpoint`: 对象存储端点URL (覆盖配置文件)
- `-a, --access-key`: 访问密钥 (覆盖配置文件)
- `-s, --secret-key`: 秘密密钥 (覆盖配置文件)
- `-i, --incremental`: 启用增量上传 (默认: true)
- `-w, --workers`: 并发上传工作数 (默认: 5)
- `-v, --verbose`: 详细输出

#### `objectsync backup`命令参数：
- `-c, --config`: 配置文件路径
- `-e, --endpoint`: 对象存储端点URL (覆盖配置文件)
- `-a, --access-key`: 访问密钥 (覆盖配置文件)
- `-s, --secret-key`: 秘密密钥 (覆盖配置文件)
- `-i, --incremental`: 启用增量备份 (默认: true)
- `-w, --workers`: 并发下载工作数 (默认: 5)
- `-v, --verbose`: 详细输出

### 🐛 修复问题

- 修复了交互式菜单中输入目录为空的问题
- 改进了多桶配置的处理逻辑
- 优化了错误提示和用户反馈
- 简化了代码架构，提高了可维护性

### 🔗 向后兼容

- 完全保持与0.0.1版本的配置文件兼容性
- 所有原有的多桶下载功能保持不变
- 交互式界面完全向后兼容

---

## [v0.0.1] - 2025-06-26

### 🎉 首次发布

这是 ObjectSync 对象存储下载工具的首个版本！一个用Go编写的对象存储批量下载工具，支持全量和增量下载。

### ✨ 核心功能

- **📥 对象存储下载**: 批量下载S3兼容对象存储中的所有文件到本地
- **🔄 增量备份**: 基于ETag和修改时间的智能增量检测，避免重复下载
- **⚡ 并发下载**: 可配置的多线程并发下载，充分利用带宽
- **📊 实时进度**: 精美的进度条显示，包含下载速度和预计时间
- **💾 状态管理**: JSON状态文件记录下载历史，支持断点续传
- **🔧 多桶支持**: 支持在单一配置文件中管理多个存储桶
- **🎮 交互式界面**: 用户友好的中文交互式菜单系统
- **⚙️ 灵活配置**: YAML配置文件，支持全局和桶级别的独立配置

### 🎨 用户体验

- **🇨🇳 完整中文界面**: 从菜单到日志输出的全中文用户体验
- **🖥️ 智能启动模式**: 无参数运行时自动启动交互式菜单
- **📱 多命令支持**: 提供`backup`、`config`、`status`、`version`等子命令
- **🔍 配置验证**: 自动验证连接配置，启动前检测问题
- **📋 详细状态**: 查看备份历史、文件统计和上次运行状态

### 🔧 技术架构

- **🏗️ 模块化设计**: 采用清晰的分层架构(`cmd`/`internal`结构)
- **📚 依赖管理**: 使用`cobra`CLI框架和`viper`配置管理
- **☁️ S3兼容性**: 基于AWS SDK Go，支持所有S3兼容存储
- **🧩 跨平台**: 支持Windows、Linux、macOS的AMD64和ARM64架构
- **🔒 安全连接**: 支持HTTPS连接和访问密钥认证
- **🎯 UTF-8编码**: Windows平台自动UTF-8控制台设置

### 📦 配置结构

```yaml
# 对象存储连接配置
ceph:
  endpoint: "http://your-storage-endpoint:7480"
  access_key: "your-access-key"
  secret_key: "your-secret-key"

# 多桶配置支持
buckets:
  - name: "my-bucket"
    output_dir: "./backup/my-bucket"
    state_file: ".backup_state.json"
    workers: 8        # 可选：桶级别并发数
    verbose: true     # 可选：桶级别详细输出

# 全局备份配置
backup:
  incremental: true   # 启用增量备份
  workers: 5         # 默认并发数
  verbose: false     # 详细输出
```

### 🚀 使用方式

#### 交互式模式（推荐）
```bash
# 直接运行启动交互菜单
objectsync

# 或明确调用菜单命令
objectsync menu
```

#### 命令行模式
```bash
# 初始化配置
objectsync config init

# 验证配置
objectsync config validate

# 开始备份
objectsync backup --verbose

# 查看状态
objectsync status

# 查看版本
objectsync version
```

### 🛠️ 构建与发布

- **📦 Makefile支持**: 完整的构建、测试、发布工具链
- **🤖 GitHub Actions**: 自动多平台构建和发布
- **📋 动态Changelog**: 从CHANGELOG.md自动生成发布说明
- **🏷️ 版本注入**: 构建时自动注入版本、时间和Git提交信息
- **🗜️ 压缩优化**: 构建时使用`-s -w`标志减小文件体积

### 🔗 兼容性

支持的S3兼容的对象存储服务：
- **Ceph Object Gateway (RGW)**: 已测试


### 🎯 适用场景

- **数据备份**: 定期将对象存储数据同步到本地
- **数据迁移**: 从对象存储批量迁移到本地存储
- **离线分析**: 下载数据到本地进行分析处理
- **灾难恢复**: 快速恢复对象存储数据
- **开发测试**: 获取生产数据到开发环境

### 🚧 已知限制（已在0.1.0中解决）

- ~~仅支持下载方向（对象存储→本地），暂不支持上传~~ ✅ 已在0.1.0中实现
- 状态文件基于JSON格式，大量文件时可能较大
- 目前仅支持桶级别的配置，不支持前缀过滤

---

## [Unreleased]

### 计划中的功能
- 增量同步优化
- 更多存储后端支持 